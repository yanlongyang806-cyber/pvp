name: Build GameServer (PVP Edition)

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  build:
    name: Build GameServer
    runs-on: windows-latest
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v3
      
    - name: ğŸ”§ Setup MSBuild
      uses: microsoft/setup-msbuild@v1.1
      
    - name: ğŸ“Š Check project files
      run: |
        Write-Host "=== æ£€æŸ¥é¡¹ç›®æ–‡ä»¶ ===" -ForegroundColor Cyan
        Get-ChildItem GameServer\*.sln | Select-Object Name
        Get-ChildItem GameServer\*.vcxproj | Select-Object Name
        
    - name: ğŸ“ Display dependencies status
      run: |
        Write-Host "=== ä¾èµ–çŠ¶æ€ ===" -ForegroundColor Yellow
        Write-Host "æ³¨æ„: æ­¤é¡¹ç›®éœ€è¦å®Œæ•´çš„Crypticå¼•æ“ä¾èµ–åº“"
        Write-Host "ç¼ºå¤±çš„ä¾èµ–åº“:"
        Write-Host "  - libs\AILib"
        Write-Host "  - libs\ContentLib"
        Write-Host "  - libs\ServerLib"
        Write-Host "  - libs\UtilitiesLib"
        Write-Host "  - libs\WorldLib"
        Write-Host "  - CrossRoads\GameServerLib (Combatç³»ç»Ÿ)"
        Write-Host ""
        Write-Host "PropertySheetsçŠ¶æ€:"
        Test-Path "PropertySheets\GeneralSettings.props"
        
    - name: ğŸ—ï¸ Attempt to build standalone solution
      continue-on-error: true
      run: |
        Write-Host "=== å°è¯•ç¼–è¯‘ç‹¬ç«‹è§£å†³æ–¹æ¡ˆ ===" -ForegroundColor Green
        cd GameServer
        msbuild NNOGameServer_Standalone.sln /p:Configuration=Debug /p:Platform=Win32 /v:minimal /nologo
      shell: powershell
      
    - name: ğŸ“‹ Build summary
      if: always()
      run: |
        Write-Host "=== ç¼–è¯‘æ€»ç»“ ===" -ForegroundColor Cyan
        Write-Host ""
        Write-Host "é¡¹ç›®çŠ¶æ€: å…¨åœ°å›¾PVP GameServer"
        Write-Host "æºç æ–‡ä»¶: 132ä¸ªæ–‡ä»¶, 66,000+è¡Œä»£ç "
        Write-Host "PVPåŠŸèƒ½: âœ… å·²å®ç° (PvPInvites, Pvp_Resources, Combat)"
        Write-Host ""
        Write-Host "âš ï¸  ç¼–è¯‘éœ€è¦å®Œæ•´çš„Crypticå¼•æ“æºç æ ‘"
        Write-Host "ğŸ“¦ é¢„ç¼–è¯‘çš„GameServer.exeå·²åœ¨ä»“åº“æ–‡æ¡£ä¸­æä¾›è·å–æ–¹æ³•"
        Write-Host ""
        Write-Host "æŸ¥çœ‹æ–‡æ¡£:"
        Write-Host "  - README.md - é¡¹ç›®è¯´æ˜"
        Write-Host "  - COMPILE_STATUS.md - ç¼–è¯‘çŠ¶æ€"
        Write-Host "  - PVPå¯åŠ¨æŒ‡å—.md - PVPåŠŸèƒ½è¯´æ˜"
        Write-Host "  - bin/README_è¿è¡Œè¯´æ˜.md - è¿è¡ŒæŒ‡å—"
        
    - name: ğŸ“¦ Archive project info
      uses: actions/upload-artifact@v3
      with:
        name: project-documentation
        path: |
          README.md
          COMPILE_STATUS.md
          PVPå¯åŠ¨æŒ‡å—.md
          GameServer/ç¼–è¯‘è¯´æ˜.md
          GameServer/ç¼–è¯‘æŒ‡å—_Crypticå¼•æ“.md
          bin/README_è¿è¡Œè¯´æ˜.md
          bin/DOWNLOAD_EXE.md

