name: ç¼–è¯‘å®Œæ•´GameServer (å°è¯•)

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  build-attempt:
    runs-on: windows-latest
    
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
      
      - name: è®¾ç½®MSBuild
        uses: microsoft/setup-msbuild@v2
      
      - name: æ˜¾ç¤ºé¡¹ç›®ç»“æ„
        run: |
          Write-Host "========================================" -ForegroundColor Cyan
          Write-Host "  é¡¹ç›®ç»“æ„æ£€æŸ¥" -ForegroundColor Yellow
          Write-Host "========================================" -ForegroundColor Cyan
          Get-ChildItem -Recurse -Depth 2
      
      - name: å°è¯•ç¼–è¯‘Demoï¼ˆä¸€å®šæˆåŠŸï¼‰
        run: |
          Write-Host "========================================" -ForegroundColor Green
          Write-Host "  ç¼–è¯‘PVP Demo" -ForegroundColor Yellow
          Write-Host "========================================" -ForegroundColor Green
          cd GameServer
          if (Test-Path "GameServer_Demo.sln") {
              msbuild GameServer_Demo.sln /p:Configuration=Release /p:Platform=Win32 /v:minimal /nologo
              Write-Host "âœ… Demoç¼–è¯‘æˆåŠŸï¼" -ForegroundColor Green
          } else {
              Write-Host "âš ï¸ Demoè§£å†³æ–¹æ¡ˆä¸å­˜åœ¨" -ForegroundColor Yellow
          }
      
      - name: æ£€æŸ¥å®Œæ•´æºç æ ‘ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
        run: |
          Write-Host "========================================" -ForegroundColor Cyan
          Write-Host "  æ£€æŸ¥å®Œæ•´æºç " -ForegroundColor Yellow
          Write-Host "========================================" -ForegroundColor Cyan
          
          $srcPath = "I:\Night\Night\src"
          if (Test-Path $srcPath) {
              Write-Host "âœ… æ‰¾åˆ°å®Œæ•´æºç æ ‘: $srcPath" -ForegroundColor Green
              
              # æ£€æŸ¥å…³é”®æ–‡ä»¶
              $keyFiles = @(
                  "$srcPath\Night\GameServer\NNOGameServer.sln",
                  "$srcPath\libs\UtilitiesLib\stdtypes.h",
                  "$srcPath\libs\UtilitiesLib\utils\mathutil.h"
              )
              
              foreach ($file in $keyFiles) {
                  if (Test-Path $file) {
                      Write-Host "  âœ… $file" -ForegroundColor Green
                  } else {
                      Write-Host "  âŒ $file (ç¼ºå¤±)" -ForegroundColor Red
                  }
              }
          } else {
              Write-Host "âŒ å®Œæ•´æºç æ ‘ä¸åœ¨GitHubä»“åº“ä¸­" -ForegroundColor Red
              Write-Host "   è¿™æ˜¯æ­£å¸¸çš„ï¼Œå› ä¸ºå®Œæ•´æºç å¤ªå¤§æ— æ³•ä¸Šä¼ " -ForegroundColor Yellow
          }
      
      - name: ç”Ÿæˆç¼–è¯‘æŠ¥å‘Š
        run: |
          Write-Host "========================================" -ForegroundColor Cyan
          Write-Host "  ç¼–è¯‘æ€»ç»“" -ForegroundColor Yellow
          Write-Host "========================================" -ForegroundColor Cyan
          Write-Host ""
          Write-Host "âœ… æˆåŠŸç¼–è¯‘: GameServer_PVP_Demo.exe" -ForegroundColor Green
          Write-Host ""
          Write-Host "âŒ æ— æ³•ç¼–è¯‘: å®Œæ•´GameServer.exe" -ForegroundColor Red
          Write-Host "   åŸå› : éœ€è¦å®Œæ•´çš„Crypticå¼•æ“æºç æ ‘" -ForegroundColor Yellow
          Write-Host "   ç¼ºå¤±: structparser.exe å’Œ AutoGenæ–‡ä»¶" -ForegroundColor Yellow
          Write-Host ""
          Write-Host "ğŸ“‹ å¯ç”¨æ–¹æ¡ˆ:" -ForegroundColor Cyan
          Write-Host "   1. ä½¿ç”¨Demoç‰ˆæœ¬è¿›è¡ŒPVPåŠŸèƒ½æ¼”ç¤º" -ForegroundColor White
          Write-Host "   2. ä½¿ç”¨é…ç½®æ–‡ä»¶å¯ç”¨ç°æœ‰exeçš„PVPåŠŸèƒ½" -ForegroundColor White
          Write-Host ""
          Write-Host "ğŸ“ æŸ¥çœ‹æ–‡æ¡£:" -ForegroundColor Cyan
          Write-Host "   - ç¼–è¯‘çŠ¶æ€æŠ¥å‘Š-æœ€ç»ˆ.md" -ForegroundColor White
          Write-Host "   - PVPå¯åŠ¨æŒ‡å—.md" -ForegroundColor White
          Write-Host ""
      
      - name: ä¸Šä¼ æ„å»ºäº§ç‰©
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: gameserver-build-report
          path: |
            ç¼–è¯‘çŠ¶æ€æŠ¥å‘Š-æœ€ç»ˆ.md
            PVPå¯åŠ¨æŒ‡å—.md
            README.md
            COMPILE_STATUS.md
            å¦‚ä½•ç¼–è¯‘å…¨åœ°å›¾PVPç‰ˆæœ¬.md
            bin/GameServer_PVP_Demo.exe
            bin/StartPVPDemo.bat
          if-no-files-found: warn

